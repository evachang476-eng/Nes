<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nespresso è† å›Šç®¡å®¶</title>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QZ7E6ZT2Z6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-QZ7E6ZT2Z6');
    </script>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body { background-color: #f0f2f5; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
        .capsule-card, .recipe-card, .promo-card, .backup-card { border-radius: 16px; overflow: hidden; border: none; transition: 0.2s; }
        .capsule-card:hover, .recipe-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
        .circle { width: 42px; height: 42px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 10px; text-shadow: 0 1px 2px rgba(0,0,0,0.3); border: 2px solid rgba(255,255,255,0.2); }
        .badge-available { background-color: #d1e7dd; color: #0f5132; }
        .badge-missing { background-color: #f8d7da; color: #842029; }
        .btn-brew { background-color: #b8860b; color: white; border: none; }
        .btn-brew:hover { background-color: #986f0b; color: white; }
        .btn-brew:disabled { background-color: #e0e0e0; color: #999; }
        .btn-shopee { background-color: #ee4d2d; color: white; font-weight: bold; }
        .btn-shopee:hover { background-color: #d73211; color: white; }
        .nav-pills .nav-link.active { background-color: #333; color: #fff; }
        .nav-pills .nav-link { color: #666; font-weight: bold; }
        .custom-input-enter-active, .custom-input-leave-active { transition: all 0.3s ease; }
        .custom-input-enter-from, .custom-input-leave-to { opacity: 0; transform: translateY(-10px); }
        .backup-textarea { font-family: monospace; font-size: 12px; background: #f8f9fa; color: #666; }
    </style>
</head>
<body>

<div id="app" class="container py-4" style="max-width: 600px;">
    
    <div class="text-center mb-4">
        <h2 class="fw-bold text-dark">â˜• Nespresso å±…å®¶å’–å•¡é¤¨</h2>
        <small class="text-muted">åº«å­˜ç®¡ç† & é£Ÿè­œæ¨è–¦</small>
    </div>

    <ul class="nav nav-pills nav-fill mb-4 bg-white p-2 rounded-4 shadow-sm">
        <li class="nav-item"><a class="nav-link rounded-pill" :class="{active: currentView==='INVENTORY'}" @click="currentView='INVENTORY'" href="#">ğŸ“Š åº«å­˜</a></li>
        <li class="nav-item"><a class="nav-link rounded-pill" :class="{active: currentView==='RECIPES'}" @click="currentView='RECIPES'" href="#">ğŸ¹ é£Ÿè­œ</a></li>
        <li class="nav-item"><a class="nav-link rounded-pill" :class="{active: currentView==='BACKUP'}" @click="currentView='BACKUP'" href="#">â˜ï¸ å‚™ä»½</a></li>
    </ul>

    <div v-if="currentView === 'INVENTORY'">
        <div class="card p-3 mb-4 shadow-sm bg-white">
            <h6 class="card-title fw-bold text-secondary mb-3">ğŸ“¦ å¿«é€Ÿé€²è²¨</h6>
            <div class="row g-2">
                <div class="col-3">
                    <select v-model="newCapsule.system" class="form-select text-center fw-bold">
                        <option value="OL">OL</option>
                        <option value="VL">VL</option>
                    </select>
                </div>
                <div class="col-6">
                    <select v-model="newCapsule.selectedName" class="form-select">
                        <option value="CUSTOM">â• è‡ªè¡Œè¼¸å…¥ (æ–°å£å‘³)</option>
                        <option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
                        <optgroup v-for="(list, category) in currentSystemList" :label="category">
                            <option v-for="name in list" :value="name">{{ name }}</option>
                        </optgroup>
                    </select>
                </div>
                <div class="col-3">
                    <input v-model.number="newCapsule.quantity" type="number" class="form-control text-center" placeholder="æ•¸é‡">
                </div>
                <transition name="custom-input">
                    <div class="col-12" v-if="newCapsule.selectedName === 'CUSTOM'">
                        <input v-model="newCapsule.customInput" type="text" class="form-control border-primary" placeholder="è«‹è¼¸å…¥è† å›Šåç¨±">
                    </div>
                </transition>
                <div class="col-12 mt-2">
                    <button @click="addCapsule" class="btn btn-dark w-100 fw-bold rounded-pill">ï¼‹ åŠ å…¥åº«å­˜</button>
                </div>
            </div>
        </div>

        <div class="d-flex gap-2 mb-3 overflow-auto">
            <button @click="filter='ALL'" class="btn btn-sm rounded-pill px-3" :class="filter==='ALL' ? 'btn-secondary' : 'btn-outline-secondary'">å…¨éƒ¨</button>
            <button @click="filter='OL'" class="btn btn-sm rounded-pill px-3" :class="filter==='OL' ? 'btn-secondary' : 'btn-outline-secondary'">Original</button>
            <button @click="filter='VL'" class="btn btn-sm rounded-pill px-3" :class="filter==='VL' ? 'btn-secondary' : 'btn-outline-secondary'">Vertuo</button>
        </div>

        <div v-if="filteredCapsules.length === 0" class="text-center text-muted py-5">å°šç„¡è³‡æ–™ï¼Œè«‹å…ˆæ–°å¢è† å›Šã€‚</div>
        <div v-else>
            <div v-for="cap in filteredCapsules" :key="cap.id" class="card mb-3 shadow-sm capsule-card bg-white">
                <div class="card-body d-flex align-items-center justify-content-between py-3">
                    <div class="d-flex align-items-center gap-3">
                        <div class="circle shadow-sm" :style="{ backgroundColor: getCapsuleColor(cap.name) }">{{ cap.system === 'OL' ? 'OL' : 'VL' }}</div>
                        <div><h6 class="mb-0 fw-bold">{{ cap.name }}</h6><small class="text-muted">å‰©é¤˜ <span class="fw-bold" :class="cap.quantity<5?'text-danger':'text-dark'">{{ cap.quantity }}</span> é¡†</small></div>
                    </div>
                    <div class="d-flex align-items-center gap-1">
                        <button @click="cap.quantity+=10" class="btn btn-light btn-sm text-secondary rounded-circle" style="width:32px;height:32px;">+</button>
                        <button @click="drink(cap)" :disabled="cap.quantity <= 0" class="btn btn-brew btn-sm px-3 fw-bold rounded-pill">{{ cap.quantity > 0 ? 'æ²–ç…®' : 'ç¼ºè²¨' }}</button>
                        <button @click="remove(cap)" class="btn btn-link text-danger btn-sm px-2">âœ•</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card promo-card bg-white border border-danger border-opacity-25 mt-5 mb-4 shadow-sm">
            <div class="card-body text-center p-4">
                <h5 class="fw-bold text-dark mb-2">ğŸ›ï¸ è† å›Šåº«å­˜ä¸è¶³äº†å—ï¼Ÿ</h5>
                <p class="text-muted small mb-4">å‰å¾€ Nespresso è¦çš®å®˜æ–¹æ——è‰¦åº—è£œè²¨ï¼Œ<br>äº«å—åŸå» å“è³ªèˆ‡å¿«é€Ÿå‡ºè²¨ã€‚</p>
                <a href="https://shopee.tw/nespresso_tw?entryPoint=ShopBySearch&searchKeyword=nespresso" 
                   target="_blank" 
                   class="btn btn-shopee w-100 rounded-pill py-2 shadow-sm"
                   onclick="gtag('event', 'click_shopee', {'event_category': 'conversion', 'event_label': 'inventory_page'});">
                    å‰å¾€å®˜æ–¹æ——è‰¦åº—è£œè²¨
                </a>
            </div>
        </div>
    </div>

    <div v-if="currentView === 'RECIPES'">
        <div class="card mb-4 border-0 shadow-sm bg-light">
            <div class="card-body p-3">
                <button @click="showCreateRecipe = !showCreateRecipe" class="btn btn-outline-dark w-100 fw-bold border-dashed">{{ showCreateRecipe ? 'æ”¶èµ·è¡¨å–®' : 'âœ¨ é»æ­¤å»ºç«‹æˆ‘çš„å°ˆå±¬ç‰¹èª¿' }}</button>
                <div v-if="showCreateRecipe" class="mt-3">
                    <input v-model="newRecipe.name" type="text" class="form-control mb-2" placeholder="é£Ÿè­œåç¨±">
                    <input v-model="newRecipe.desc" type="text" class="form-control mb-2" placeholder="æè¿°">
                    <input v-model="newRecipe.ingredients" type="text" class="form-control mb-2" placeholder="æ‰€éœ€ææ–™ (ç”¨é€—è™Ÿåˆ†éš”)">
                    <input v-model="newRecipe.keywords" type="text" class="form-control mb-2" placeholder="é©åˆè† å›Šé—œéµå­— (ç”¨é€—è™Ÿåˆ†éš”)">
                    <button @click="addRecipe" class="btn btn-dark w-100 mt-2">å„²å­˜é£Ÿè­œ</button>
                </div>
            </div>
        </div>

        <div class="row g-3">
            <div class="col-12" v-for="(recipe, rIndex) in recipeStatusList" :key="rIndex">
